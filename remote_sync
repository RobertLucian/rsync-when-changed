#!/usr/bin/env bash

if [ -z "$AWS_KEY"] || [ -z "$EC2_INSTANCE" ]; then
    echo "AWS_KEY or EC2_INSTANCE variables are empty"
    exit 1
fi

if [ -z "$0" ]; then
    echo "No positional argument provided. Path expected."
    exit 1
fi

when-changed -vr1s ./ -c rsync -Pav -e "ssh -i $AWS_KEY" ./ "$EC2_INSTANCW":"$0"